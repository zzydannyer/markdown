### 浏览器中输入URL并回车后发生了什么

1. **构建请求**
   * 浏览器查找当前URL是否存在**DNS缓存**，并比较缓存是否过期
     * 浏览器缓存 -> 系统缓存 -> 路由器缓存 -> 运营商缓存
   * 发送到DNS服务器，**DNS解析**URL对应的IP
   * 在`应用层`封装**HTTP**请求报文（==请求行==、==请求头==、==请求体==）
   * 在`传输层`根据IP建立**TCP**/ **UDP**连接（**三次握手**）
2. **网络传输**
3. **构建响应**
* 服务器处理请求，返回指定**URL**的数据（或错误信息，或重定向新的地址），浏览器接收**HTTP**响应。
4. **浏览器渲染**
   * 解码：**Unicode**码，分词：Unicode 码分词成短语 token
   * 解析HTML

     * 构建节点 -> 串联节点构建**DOM**树
   * 解析CSS
     * 构建render tree和renderLayerTree
     * 回流 和 重绘
   * 解析JS
   * 渲染页面（回流必然重绘，重绘未必回流）
   * dom, css => render tree => 计算布局信息(回流) => 引擎渲染 (重绘)
5. 关闭连接
   * 关闭**TCP**连接（**四次挥手**）。

### 七层协议

1. 应用层
2. 表示层
3. 会话层
4. 传输层
5. 网络层
6. 数据链路层
7. 物理层



### HTTPS

#### HTTP缓存

* **强制缓存**

```js
Cache-Control : max-age = 300 单位（秒 / s）/ no-cache
```

* **协商缓存**

```js
Last-Modified: 资源上一次修改的时间
ETag: 资源对应的唯一字符串
返回 304 从缓存拿资源
```

#### Cookie

发送请求时带上用户信息cookie

```js
res.setHeader('Set-Cookie',`username=${username};path=/`)
```

## 性能优化

* **加载层面**
  
  1. 减少HTTP请求（雪碧图，CSS，JS文件合并，CSS代替图片）
  
     减少DNS查询
  
  2. 避免重定向
  
  3. 缩减文件大小（资源压缩，Webpack，GZip压缩，图片和字体压缩）
  
  4. 合理运用缓存
  
  5. 多域名分发：划分内容到不同域名
  
  6. 使用CDN（大图加载，大文件加载，类库等静态文件）
  
  7. HTTP2
  
  8. SSR服务端渲染，预渲染
  
  9. 懒加载，减少首屏加载
  
  10. 减少回流，使用定位
  
  9. 减少DOM元素的数量和对其的操作，对操作量较大的dom操作，用文档碎片操作DOM

## 同源策略

* 同源：URL由`协议`、`域名`、`端口`和路径组成，如果这三个都相同，则表示他们同源。
* 浏览器的同源策略，限制不同浏览器中的`cookie读取`，`DOM操作`，`ajax请求`，`document`或`script脚本`

#### 如何解决跨域

* Jsonp

  `<script>`、`<img>`、`<iframe>`、`<link>`等标签都可以加载跨域资源。
  只能发起GET请求。

* document.domain + iframe跨域

* Nodejs中间件代理跨域

* Nginx反向代理

* CORS`Cross-origin resourse sharing`服务端进行控制，支持各种请求方式，但会产生额外请求

  1. 对于简单请求，头信息中会携带`origin`字段，用来说明请求来自哪个源（协议+域名+端口），服务器根据此值决定时候同意请求，返回包含`Access-Conctrol-Allow-Origin`，即Origin指定域名在许可范围内。

  2. 对于非简单请求，会在正式通信前增加一次`预检请求`，头信息携带`Origin`、` Access-Control-Request-Method`、 `Access-Control-Request-Headers`字段，收到肯定答复后才会发起XMLHttpRequest请求，否则报错。之后的正式请求和简单请求一样。


## 端口

* **port**，设备与外界通讯交流的出口，分为虚拟端口和物理端口
  * **21**端口：FTP文件传输
  * **80**端口：HTTP超文本传输服务
  * **443**端口：HTTPS加密超文本传输服务
  * **3306**端口：mysql
  * **27017**端口：mongodb

## 跨站脚本攻击（XSS）

XSS，即`Cross Site Script`（跨站脚本攻击）
XSS 攻击是指攻击者在网站上注入恶意的客户端代码，利用恶意脚本对客户端网页进行篡改，从而在用户浏览网页时，对用户浏览器进行控制或者获取用户隐私数据的一种攻击方式。有很多种方式进行 XSS 攻击，但它们的共同点为：将一些隐私数据像`cookie`、`session`发送给攻击者，将受害者重定向到一个由攻击者控制的网站，在受害者的机器上进行一些恶意操作。

